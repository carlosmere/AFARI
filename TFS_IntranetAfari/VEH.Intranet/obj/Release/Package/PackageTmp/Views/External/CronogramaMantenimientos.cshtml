@model VEH.Intranet.ViewModel.External.CronogramaMantenimientosViewModel
@{
    ViewBag.Title = "Cronograma de Mantenimientos";
}
@section Breadcrumbs{
    <li><a href="@Url.Action("LstEdificio", "Building")">Lista de Edificios</a></li>
    <li><a href="@Url.Action("LstOpcionEdificio", "Building", new { EdificioId = Model.EdificioId })">Opciones Edificio</a></li>
}
<div class="panel panel-inverse">
    <div class="panel-heading">
        <i class="fa fa-table"></i> Filtros
    </div>
    <div class="panel-body">
        <form action="@Url.Action("CronogramaMantenimientos","External")">
            <input hidden name="EdificioId" value="@Model.EdificioId" />
            <input hidden name="Editar" value="@(Model.Editar ? "True": "False")" />
            <div class="form-group">
                <label class="col-md-1 control-label"><strong>Año</strong></label>
                <div class="col-md-6">
                    @Html.DropDownListFor(x => x.Anio, new SelectList(Model.LstAnios, "Value", "Text"), new { @class = "form-control select2" })
                    @Html.ValidationMessageFor(x => x.Anio)
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-success"><i class="fa fa-filter"></i> Filtrar</button>
                </div>
            </div>
        </form>
    </div>
</div>
<div class="panel panel-inverse">
    <div class="panel-body">
        <center><h4>Año : @Model.Anio</h4></center>
        <form method="post">
            @Html.HiddenFor( x => x.Anio)
            <table class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>Equipo</th>
                        @for (int i = 1; i <= 12; i++)
                        {
                            <th>
                                @(new DateTime(2000, i, 1).ToString("MMMM", System.Globalization.CultureInfo.CreateSpecificCulture("es")))
                            </th>
                        }
                    </tr>
                </thead>
                <tbody>
                    @foreach (var equipo in Model.LstEquipos)
                    {
                        <tr>
                            <td>@equipo</td>
                            @for (int i = 1; i <= 12; i++)
                            {
                                var mes = i.ToString();
                                var dato = Model.LstDatos.FirstOrDefault(x => x.Tipo == "Crono[" + equipo + "]" && x.Nombre == mes);
                                <td style="background-color:@(Model.mapa.ContainsKey(equipo+i)?"lightgrey":"white")">
                                    @if ((Session.GetRol() ?? AppRol.Propietario) == AppRol.Administrador && Model.Editar)
                                    {
                                        <div class="row">
                                            <input type="checkbox" class="col-sm-6" name="che|@(i)|@(equipo)" @(Model.mapa.ContainsKey(equipo + i) ? "checked='checked'" : "") />
                                            <input type="text" class="col-sm-6" name="num|@(i)|@(equipo)" value="@(Model.mapa.ContainsKey(equipo+i)?(Model.mapa[equipo+i]!=0?Model.mapa[equipo+i].ToString():""):"")" />
                                        </div>

                                    }
                                    else
                                    {
                                        <center>
                                            <i>@(Model.mapa.ContainsKey(equipo + i) ? (Model.mapa[equipo + i] != 0 ? Model.mapa[equipo + i].ToString() : "") : "")</i>
                                            @if (dato != null && dato.EsRealizado == true)
                                            {
                                            <span class="fa fa-times"></span>
                                            }
                                        </center>
                                    }
                                </td>
                            }
                        </tr>
                    }
                </tbody>
            </table>
            @if ((Session.GetRol() ?? AppRol.Propietario) == AppRol.Administrador && Model.Editar)
            {
                <a class="btn btn-warning" href="#" @Data.ModalLink("_MarcarCronogramaMantenimiento", "External", new { EdificioId = Model.EdificioId , Anio = Model.Anio })><i class="fa fa-times"></i>&nbsp;Marcar</a>
                <button class="btn btn-primary" type="submit"><i class="fa fa-save"></i>&nbsp;Guardar</button>
            }
        </form>
    </div>
</div>  